<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xml:lang="en"
lang="en"
xmlns="http://www.w3.org/1999/xhtml"
xmlns:epub="http://www.idpf.org/2007/ops">
<head>
<title>Microsoft Power BI Data Analyst Certification Companion: Preparation for Exam PL-300</title>
<link rel="stylesheet" type="text/css" href="../override_v1.css"/>
<link rel="stylesheet" type="text/css" href="../css/springer_epub.css"/>
</head>
<body>
<div id="book-content">
<div id="sbo-rt-content"><div epub:type="chapter" role="doc-chapter"><div class="ChapterContextInformation"><div class="ContextInformation" id="b978-1-4842-9013-2_7"><div class="ChapterCopyright">© The Author(s), under exclusive license to APress Media, LLC, part of Springer Nature 2023</div><span class="ContextInformationAuthorEditorNames">J. Jolly</span><span class="ContextInformationBookTitles"><span class="BookTitle">Microsoft Power BI Data Analyst Certification Companion</span></span><span class="ContextInformationSeries"><span class="SeriesTitle" lang="en">Certification Study Companion Series</span></span><span class="ChapterDOI"><a href="https://doi.org/10.1007/978-1-4842-9013-2_7">https://doi.org/10.1007/978-1-4842-9013-2_7</a></span></div></div><!--Begin Abstract--><div class="MainTitleSection"><h1 class="ChapterTitle" lang="en">7. Create Model Calculations Using DAX</h1></div><div class="AuthorGroup"><div class="AuthorNames"><span class="Author"><span class="AuthorName">Jessica Jolly</span><sup><a href="#Aff11">1</a> <span class="ContactIcon"> </span></sup></span></div><div class="Affiliations"><div class="Affiliation" id="Aff11"><span class="AffiliationNumber">(1)</span><div class="AffiliationText">Evanston, IL, USA</div></div><div class="ClearBoth"> </div></div></div><!--End Abstract--><div class="Fulltext"><p class="Para" id="Par2">DAX (Data Analysis Expressions) is the language Power BI uses to create content: tables, columns, security roles, and measures. We covered the first three <span id="ITerm1">uses</span> of DAX in the last chapter. In this chapter, we will focus on measures. <span id="ITerm2">Measures</span> are calculations that your data doesn’t already have. What kind of calculations? They can be anything from a simple addition to a way to conditionally format a visual or to create a dynamic title for a visual.</p><section class="Section1 RenderAsSection1" id="Sec1"><h2 class="Heading">Measures</h2><div class="Para" id="Par3">What do you use when a <span id="ITerm3">calculated column</span> is not necessary? For example, in the earlier chapter, we created a column that calculates the total for each row (<span class="EmphasisFontCategoryNonProportional ">[LineTotal]</span>), but we need to know the total for <em class="EmphasisTypeItalic ">all</em> sales, not just the total line by line. We need a measure, which is a calculation not currently present in the data. In Figure <span class="InternalRef"><a href="#Fig1">7-1</a></span>, you can see how to enter a <span id="ITerm4">measure</span> in the Formula Bar:<div class="ProgramCode" id="PC1"><div class="LineGroup"><div class="FixedLine">All_Sales=SUM('Orders Details'[LineTotal])</div></div></div><figure class="Figure" id="Fig1"><div class="MediaObject" id="MO1"><img alt="" aria-describedby="d64e373" src="../images/532800_1_En_7_Chapter/532800_1_En_7_Fig1_HTML.png" style="width:42.8em" width="1712" height="660"/><div class="TextObject" id="d64e373"><p class="Para" id="Par123">A screenshot of an excel sheet that lists the options under the measure tools, and the arrow points to the D A X expression in the formula bar, new measure tab, and measure option.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-1</span><p class="SimplePara">Entering a <span id="ITerm5">measure</span></p></div></figcaption></figure></div><p class="Para" id="Par4">This expression adds up the entire column called <span id="ITerm6"><span class="EmphasisFontCategoryNonProportional ">LineTotal</span></span> in the table called <span class="EmphasisFontCategoryNonProportional ">'Orders Details'</span> and creates a measure called <span id="ITerm7"><span class="EmphasisFontCategoryNonProportional ">All_Sales</span></span>. A measure is stored inside the data model (which is why the topic is introduced in this chapter). Because a measure is not materialized, <em class="EmphasisTypeItalic ">it does not require resources from the engine</em> until it is used in a visual.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar1"><div class="Heading">Tip</div><p class="Para FirstParaInFormalPara" id="Par5">You won’t see a measure in the <span class="EmphasisFontCategoryNonProportional ">Data view</span> because it is not materialized.</p></div><div class="Para" id="Par6">Let’s revisit DAX’s basic behavior. In my classes, I search for analogies that may resonate with my audience. I have started to call DAX the “Cookie Monster.” (For folks who did not grow up with <em class="EmphasisTypeItalic ">Sesame Street</em>, “Cookie Monster” is known for gobbling down cookies.) DAX’s innate <span id="ITerm8">behavior</span> is to “gobble” up columns and produce the result, unless it is iterating (going row by row), as we covered in the previous chapter. With this in mind, let’s analyze the simple <span id="ITerm9">measure</span> used in Figure <span class="InternalRef"><a href="#Fig1">7-1</a></span>:<div class="ProgramCode" id="PC2"><div class="LineGroup"><div class="FixedLine">All_Sales=SUM('Orders Details'[LineTotal])</div></div></div></div><div class="Para" id="Par7">Right away, you should notice that <em class="EmphasisTypeItalic ">unlike calculated columns</em>, a measure <em class="EmphasisTypeItalic ">requires</em> a <span id="ITerm10">function</span>, such as SUM, AVERAGE, MIN, or MAX. In our simple example, the measure is using SUM. The function tells DAX what operation you want to perform. The result of this measure is that the entire <span class="EmphasisFontCategoryNonProportional ">'Orders Details'[LineTotal]</span> column is added up.<div class="ProgramCode" id="PC3"><div class="LineGroup"><div class="FixedLine">All_Sales_Average=AVERAGE('Orders Details'[LineTotal])</div></div></div></div><p class="Para" id="Par8">In the preceding example, the <span class="EmphasisFontCategoryNonProportional ">'Orders Details'[LineTotal]</span> column is added up and then divided by the number of rows in the column—in other words, it is averaged.</p><p class="Para" id="Par9">And just to remind you, let’s reverse the question. When must you use a calculated column and not a measure? If you need to use the values that are calculated in a slicer or filter, you <em class="EmphasisTypeItalic ">must</em> use a <span id="ITerm11">calculated column</span>. If the calculations must be performed row by row to be accurate, you <em class="EmphasisTypeItalic ">must</em> use a calculated column or an iterator function (covered later in the chapter).</p></section>
<section class="Section1 RenderAsSection1" id="Sec2"><h2 class="Heading">DAX Syntax: A Quick Review</h2><div class="Para" id="Par10">I covered the <span id="ITerm12">syntax rules</span> for DAX in the previous chapter, but as you are probably new to DAX, I think they are worth repeating:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par11">DAX is <em class="EmphasisTypeItalic ">not</em> case sensitive (unlike M in the Power Query Editor).</p></li><li><p class="Para" id="Par12">Every column name is enclosed in square brackets.</p></li><li><p class="Para" id="Par13">Every column name is “fully qualified” with its table name.</p></li><li><p class="Para" id="Par14">Table names do not require single quotes around them unless the name has a space in it. (Nonetheless, I make it a practice to always enclose my table names with single quotes because that way I won’t forget to put them in when necessary.)</p></li><li><p class="Para" id="Par15">Measures are enclosed in square brackets, <em class="EmphasisTypeItalic ">without</em> a table name.</p></li><li><p class="Para" id="Par16">After a function, the arguments required by the function are enclosed in parentheses and separated by commas (exactly as formulas are entered in Excel).</p></li><li><p class="Para" id="Par17">You can nest functions within other functions.</p></li><li><p class="Para" id="Par18">You can reuse measures within other measures.</p></li><li><p class="Para" id="Par19">Functions have mandatory arguments and optional arguments. In the <span class="EmphasisFontCategoryNonProportional ">IntelliSense</span> menus, optional arguments are enclosed in square brackets.</p></li></ul></div></div><p class="Para" id="Par20">When you are first learning to write DAX, it can be confusing. One helpful tool is <span id="ITerm13"><span class="EmphasisFontCategoryNonProportional ">IntelliSense</span></span> built into the Power BI Desktop. As soon as you start typing in the <span class="EmphasisFontCategoryNonProportional ">Formula Bar</span>, <span class="EmphasisFontCategoryNonProportional ">IntelliSense</span> initiates.</p><div class="Para" id="Par21">As you start typing the name of a function, it will prompt you with the available functions that start with the letters you have typed in as shown in Figure <span class="InternalRef"><a href="#Fig2">7-2</a></span>. You can select the appropriate function from the list.<figure class="Figure" id="Fig2"><div class="MediaObject" id="MO2"><img alt="" aria-describedby="d64e558" src="../images/532800_1_En_7_Chapter/532800_1_En_7_Fig2_HTML.jpg" style="width:42.82em" width="1713" height="413"/><div class="TextObject" id="d64e558"><p class="Para" id="Par124">A screenshot of an excel sheet that lists the formula bar with the expression, which is pointed by the arrow.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-2</span><p class="SimplePara">IntelliSense suggestions for functions</p></div></figcaption></figure></div><div class="Para" id="Par22">After selecting the function, <span id="ITerm14"><span class="EmphasisFontCategoryNonProportional ">IntelliSense</span></span> will prompt with an explanation of the function and a list of the mandatory and optional arguments. Optional arguments are enclosed in square brackets, as you can see in Figure <span class="InternalRef"><a href="#Fig3">7-3</a></span>.<figure class="Figure" id="Fig3"><div class="MediaObject" id="MO3"><img alt="" aria-describedby="d64e584" src="../images/532800_1_En_7_Chapter/532800_1_En_7_Fig3_HTML.jpg" style="width:42.82em" width="1713" height="450"/><div class="TextObject" id="d64e584"><p class="Para" id="Par125">A screenshot of an excel sheet that lists the expression in a context modified by filters, and the arrow indicates the highlighted IntelliSense, mandatory argument, and optional argument.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-3</span><p class="SimplePara">IntelliSense explanation of the selected function</p></div></figcaption></figure></div><div class="Para" id="Par23">To see a list of tables (and <span id="ITerm15">columns</span>) available in the model, simply type in a single quote. You can select from the provided list of tables and fields, as shown in Figure <span class="InternalRef"><a href="#Fig4">7-4</a></span>.<figure class="Figure" id="Fig4"><div class="MediaObject" id="MO4"><img alt="" aria-describedby="d64e613" src="../images/532800_1_En_7_Chapter/532800_1_En_7_Fig4_HTML.jpg" style="width:42.82em" width="1713" height="678"/><div class="TextObject" id="d64e613"><p class="Para" id="Par126">A screenshot of an excel sheet that lists the expression with a column name, and the arrow points to the list of available tables in a single quote.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-4</span><p class="SimplePara">Enter a single quote to see a list of tables (and columns)<span id="ITerm16"></span></p></div></figcaption></figure></div><div class="Para" id="Par24">To see a list of <span id="ITerm17">measures</span> available in the model, type in a left square bracket, as shown in Figure <span class="InternalRef"><a href="#Fig5">7-5</a></span>.<figure class="Figure" id="Fig5"><div class="MediaObject" id="MO5"><img alt="" aria-describedby="d64e643" src="../images/532800_1_En_7_Chapter/532800_1_En_7_Fig5_HTML.jpg" style="width:42.82em" width="1713" height="744"/><div class="TextObject" id="d64e643"><p class="Para" id="Par127">A screenshot of an excel sheet that lists the expression, and the arrow points to the list of measures available in the model in a left square bracket.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-5</span><p class="SimplePara">Enter a left square bracket to display a list of measures in the <span id="ITerm18">model</span></p></div></figcaption></figure></div><p class="Para" id="Par25">If you are new to DAX, using <span id="ITerm19"><span class="EmphasisFontCategoryNonProportional ">IntelliSense</span></span> can guide you toward writing DAX that is syntactically correct. This does <em class="EmphasisTypeItalic ">not</em> mean that the DAX you write will work. You should test every measure in a simple visual to see the results of the DAX you have written.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar2"><div class="Heading">Tip</div><p class="Para FirstParaInFormalPara" id="Par26">Many people <span id="ITerm20">test</span> their DAX by using simple data and performing the same calculation in Excel. This is a great way to understand what DAX is doing.</p></div></section>
<section class="Section1 RenderAsSection1" id="Sec3"><h2 class="Heading">Filter Context</h2><p class="Para" id="Par27">Continuing with the “Cookie Monster” analogy, what if we want to split the cookie up, rather than just letting the “Cookie Monster” gobble the whole cookie in one bite? Enter the <span id="ITerm21">filter context</span>.</p><div class="Para" id="Par28">The measure <span class="EmphasisFontCategoryNonProportional ">All_Sales</span> produces a single number. How can we see, for example, the sales for companies in Germany? The first way, the simplest way, is to set up a slicer visual, set to “Germany,” as shown in Figure <span class="InternalRef"><a href="#Fig6">7-6</a></span>.<figure class="Figure" id="Fig6"><div class="MediaObject" id="MO6"><img alt="" aria-describedby="d64e700" src="../images/532800_1_En_7_Chapter/532800_1_En_7_Fig6_HTML.png" style="width:42.85em" width="1714" height="860"/><div class="TextObject" id="d64e700"><p class="Para" id="Par128">A screenshot of a table with the company name, country, and all sales, and the arrow indicates the highlighted Germany with the all sales option and the filter icon.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-6</span><p class="SimplePara">Creating a filter context with a slicer</p></div></figcaption></figure></div><div class="Para" id="Par29">We can create the same filter context by putting the <span class="EmphasisFontCategoryNonProportional ">'Orders Details'[Country]</span> field into the <span class="EmphasisFontCategoryNonProportional ">Filters</span> pane and setting it to “Germany,” as you can see in Figure <span class="InternalRef"><a href="#Fig7">7-7</a></span>.<figure class="Figure" id="Fig7"><div class="MediaObject" id="MO7"><img alt="" aria-describedby="d64e723" src="../images/532800_1_En_7_Chapter/532800_1_En_7_Fig7_HTML.jpg" style="width:42.82em" width="1713" height="1357"/><div class="TextObject" id="d64e723"><p class="Para" id="Par129">A screenshot of a table with the company name, country, and all sales, and the arrow indicates the customer country field with the filter context.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-7</span><p class="SimplePara">Creating a filter context with the Filters pane</p></div></figcaption></figure></div><div class="Para" id="Par30">There are numerous ways that a <span id="ITerm22">filter context</span> can be introduced. In the preceding figures, you can see the obvious ways: using a slicer or the <span class="EmphasisFontCategoryNonProportional ">Filters</span> pane. Some other ways include<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par31">A drill-through from another page (or report)</p></li><li><p class="Para" id="Par32">A selection on another visual on the same page</p></li><li><p class="Para" id="Par33">A synced slicer</p></li><li><p class="Para" id="Par34">Any combination of slicers, filters, drill-throughs, and/or hard-coded filters</p></li></ul></div></div><div class="Para" id="Par35"><blockquote class="BlockQuote"><p class="Para ParaOneEmphasisChild" id="Par36"><em class="EmphasisTypeItalic ">You should always be aware of the current filter context because it can affect the results of any measure you are using in a visual.</em></p></blockquote></div><p class="Para" id="Par37">In Figures <span class="InternalRef"><a href="#Fig6">7-6</a></span> and <span class="InternalRef"><a href="#Fig7">7-7</a></span>, the slicer or <span class="EmphasisFontCategoryNonProportional ">Filters</span> pane selection is affecting everything on the page. (I am only showing one visual, to keep the figure simple.) What happens if you want to include the total value of <span class="EmphasisFontCategoryNonProportional ">[All_Sales]</span> on the same visual where it is also filtered? We need a new <span id="ITerm23">tool</span> to be able to control the filter context’s impact on a measure.</p></section>
<section class="Section1 RenderAsSection1" id="Sec4"><h2 class="Heading">Introducing CALCULATE</h2><div class="Para" id="Par38">Not surprisingly, DAX has just such a tool available: the CALCULATE function. After practicing with simple measures, the next function to master is CALCULATE, because it allows you to fine-tune and control the filter context. Here’s a <span id="ITerm24">measure</span> that removes any filtering coming from the <span class="EmphasisFontCategoryNonProportional ">'Customers'[Country]</span> field:<div class="ProgramCode" id="PC4"><div class="LineGroup"><div class="FixedLine">All_Sales_AllCountries=</div><div class="FixedLine">CALCULATE(</div><div class="FixedLine">[All_Sales],</div><div class="FixedLine">REMOVEFILTERS('Customers'[Country]</div><div class="FixedLine">)</div></div></div></div><div class="Para" id="Par39">The CALCULATE function <em class="EmphasisTypeItalic ">requires</em> only one argument: the expression to calculate. In the preceding example, the expression is <span class="EmphasisFontCategoryNonProportional ">[All_Sales]</span>, a measure already created in the model. In addition to the required argument, CALCULATE can take <span id="ITerm25">optional arguments</span> as shown in Figure <span class="InternalRef"><a href="#Fig8">7-8</a></span>.<figure class="Figure" id="Fig8"><div class="MediaObject" id="MO8"><img alt="" aria-describedby="d64e827" src="../images/532800_1_En_7_Chapter/532800_1_En_7_Fig8_HTML.jpg" style="width:42.82em" width="1713" height="450"/><div class="TextObject" id="d64e827"><p class="Para" id="Par130">A screenshot of an excel sheet, which has a formula bar of expression, and the arrow indicates the highlighted IntelliSense, mandatory argument, and optional argument.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-8</span><p class="SimplePara">Optional filter context modifiers</p></div></figcaption></figure></div><div class="Para" id="Par40">The <span id="ITerm26">optional arguments</span> are of two types:<div class="OrderedList"><ol><li class="ListItem"><div class="ItemNumber">1)</div><div class="ItemContent"><p class="Para" id="Par41">A filter context modifier that adds, modifies, or removes filters. Examples of filter modifiers include REMOVEFILTERS, ALL, and ALLEXCEPT (and there are many more).</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><div class="ItemNumber">2)</div><div class="ItemContent"><p class="Para" id="Par42">A model modifier that alters the functionality of the model. Examples of model modifiers include USERELATIONSHIP and CROSSFILTER.</p></div><div class="ClearBoth"> </div></li></ol></div></div><p class="Para" id="Par43">CALCULATE does <em class="EmphasisTypeItalic ">not</em> wipe out the existing filter context. It superimposes the <span id="ITerm27">filter conditions</span> you have included in the CALCULATE measure <em class="EmphasisTypeItalic ">onto the existing filter context</em>.</p><div class="Para" id="Par44">In our measure <span class="EmphasisFontCategoryNonProportional ">All_Sales_AllCountries</span>, the <span id="ITerm28">REMOVEFILTERS function</span> scans the filter context for any filters coming from the ‘<span class="EmphasisFontCategoryNonProportional ">Customers'[Country]</span> field and removes them prior to calculating the measure, as you can see in Figure <span class="InternalRef"><a href="#Fig9">7-9</a></span>.<figure class="Figure" id="Fig9"><div class="MediaObject" id="MO9"><img alt="" aria-describedby="d64e900" src="../images/532800_1_En_7_Chapter/532800_1_En_7_Fig9_HTML.jpg" style="width:35.45em" width="1418" height="892"/><div class="TextObject" id="d64e900"><p class="Para" id="Par131">A screenshot of a page, which has a table with the country, all sales, and all countries, and the arrow indicates the filter pane with the selected country Germany.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-9</span><p class="SimplePara">Removing filters coming from the Filters <span id="ITerm29">pane</span></p></div></figcaption></figure></div><div class="Para" id="Par45">It is <em class="EmphasisTypeItalic ">very important</em> to realize that this measure will <em class="EmphasisTypeItalic ">not</em> remove any filters coming from another field in the <span class="EmphasisFontCategoryNonProportional ">'Customers'</span> table or from a field in another table. If, for example, we add the <span class="EmphasisFontCategoryNonProportional ">'Product'[Category]</span> field to the <span class="EmphasisFontCategoryNonProportional ">Filters</span> pane, the <span id="ITerm30"><span class="EmphasisFontCategoryNonProportional ">All_Sales_AllCountries</span></span> <em class="EmphasisTypeItalic ">will</em> reflect that change in the filter context as shown in Figure <span class="InternalRef"><a href="#Fig10">7-10</a></span>.<figure class="Figure" id="Fig10"><div class="MediaObject" id="MO10"><img alt="" aria-describedby="d64e952" src="../images/532800_1_En_7_Chapter/532800_1_En_7_Fig10_HTML.jpg" style="width:35.45em" width="1418" height="1066"/><div class="TextObject" id="d64e952"><p class="Para" id="Par132">A screenshot of a page, which has a table with the country, all sales, and all countries, and the arrow indicates the filter pane with the category name of the country Germany.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-10</span><p class="SimplePara">All_Sales_AllCountries (and All_Sales) reflects the “Beverages” <span id="ITerm31">filter</span></p></div></figcaption></figure></div><p class="Para" id="Par46">The other optional argument that CALCULATE will accept is a model modifier argument. Examples of these include USERELATIONSHIP and CROSSFILTER functions.</p><div class="Para" id="Par47">It is possible to “hard-code” a filter <span id="ITerm32">selection</span> using CALCULATE:<div class="ProgramCode" id="PC5"><div class="LineGroup"><div class="FixedLine">All_Sales_GermanyandBeverages=</div><div class="FixedLine">CALCULATE([All_Sales],</div><div class="FixedLine">'Customers'[Country]= "Germany",</div><div class="FixedLine">'Categories'[CategoryName]= "Beverages"</div><div class="FixedLine">)</div></div></div></div><div class="Para" id="Par48">In this example, there are two filter <span id="ITerm33">modifier arguments</span>:<div class="UnorderedList"><ul class="UnorderedListMarkNone"><li><p class="Para" id="Par49"><span class="EmphasisFontCategoryNonProportional ">'Customers'[Country] = "Germany"</span> hard-codes the country to Germany during the evaluation of the measure.</p></li><li><p class="Para" id="Par50"><span class="EmphasisFontCategoryNonProportional ">'Categories'[CategoryName] = "Beverages"</span> hard-codes the category to <span id="ITerm34">Beverages</span> during the evaluation of the measure, as shown in Figure <span class="InternalRef"><a href="#Fig11">7-11</a></span>.</p></li></ul></div><figure class="Figure" id="Fig11"><div class="MediaObject" id="MO11"><img alt="" aria-describedby="d64e1026" src="../images/532800_1_En_7_Chapter/532800_1_En_7_Fig11_HTML.jpg" style="width:35.45em" width="1418" height="1570"/><div class="TextObject" id="d64e1026"><p class="Para" id="Par133">A screenshot of a page, which has a table with the country, all sales, and all countries, and the arrow indicates the sales of beverages in Germany of $ 54.45 K.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-11</span><p class="SimplePara">All_Sales_GermanyandBeverages returns the same value as All_Sales <span id="ITerm35">filtered</span></p></div></figcaption></figure></div><div class="Para" id="Par51">But what happens if we set the filters on the <span class="EmphasisFontCategoryNonProportional ">Filters</span> pane to a different country and a different category? Spoiler alert: The hard-coded measure does not respond to the filter context, as <span id="ITerm36">shown</span> in Figure <span class="InternalRef"><a href="#Fig12">7-12</a></span>.<figure class="Figure" id="Fig12"><div class="MediaObject" id="MO12"><img alt="" aria-describedby="d64e1065" src="../images/532800_1_En_7_Chapter/532800_1_En_7_Fig12_HTML.jpg" style="width:35.45em" width="1418" height="1581"/><div class="TextObject" id="d64e1065"><p class="Para" id="Par134">A screenshot of a page, which has a table with the country, all sales, and all countries, and the arrow indicates the highlighted customer's country, categories, and beverages.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-12</span><p class="SimplePara">All_Sales_GermanyandBeverages does not respond to <span id="ITerm37">filter selections</span></p></div></figcaption></figure></div><div class="Para" id="Par52">In the following table, I have listed all three example <span id="ITerm38">measures</span> and how they are (or are not) modifying the filter context.<div class="Table" id="Taba"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="tcol1 align-left"/><col class="tcol2 align-left"/><col class="tcol3 align-left"/><col class="tcol4 align-left"/></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">The Measure</p></th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">All_Sales(Measure 1)</p></th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">All_Sales_AllCountries(Measure 2)</p></th><th style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">All_SalesGermanyandBeverages(Measure 3)</p></th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara"><strong class="EmphasisTypeBold ">The DAX</strong><span id="ITerm39"></span></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">=SUM('Orders Details'[LineTotal])</span></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">=CALCULATE(</span></p><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">[All_Sales],</span></p><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">REMOVEFILTERS('Customers'[Country]</span></p><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">)</span></p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">=CALCUATE([All_Sales],</span></p><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">'Customers'[Country]= "Germany",</span></p><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">'Categories'[CategoryName]= "Beverages"</span></p><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">)</span></p></td></tr><tr><td style="border-right: 0.5pt solid ; text-align: left;"><p class="SimplePara"><strong class="EmphasisTypeBold ">The explanation</strong></p></td><td style="border-right: 0.5pt solid ; text-align: left;"><p class="SimplePara">This measure does not use CALCULATE. Therefore, it is not performing any <em class="EmphasisTypeItalic ">additional</em> manipulation of the filter context. Its results depend on the external filter <span id="ITerm40">context</span>. In this example the external filter context is <span class="EmphasisFontCategoryNonProportional ">Country=France</span> and <span class="EmphasisFontCategoryNonProportional ">Category=Condiments</span>.</p></td><td style="border-right: 0.5pt solid ; text-align: left;"><p class="SimplePara">This measure uses CALCULATE to remove any filters that are coming from the <span class="EmphasisFontCategoryNonProportional ">Country</span> column in the ‘<span class="EmphasisFontCategoryNonProportional ">Customers'</span> table in the external filter context. The external context stipulates that <span class="EmphasisFontCategoryNonProportional ">Country = France</span>, and <em class="EmphasisTypeItalic ">this is still true</em>. But the presence of the <span class="EmphasisFontCategoryNonProportional ">REMOVEFILTERS</span> is imposed <em class="EmphasisTypeItalic ">in addition to</em> the external filter context. In this example, because the measure removes any filters coming from <span class="EmphasisFontCategoryNonProportional ">'Customer'[Country]</span>, the <span class="EmphasisFontCategoryNonProportional ">Country=France</span> is “overwritten” <em class="EmphasisTypeItalic ">for this measure.</em></p><p class="SimplePara">By contrast, the external filter context also has a filter <span class="EmphasisFontCategoryNonProportional ">Category=Condiments</span>. This external filter is included when calculating the measure, because nothing in the CALCULATE statement changes this external filter.</p></td><td style="text-align: left;"><p class="SimplePara">This measure uses CALCULATE to set the <span class="EmphasisFontCategoryNonProportional ">Country=Germany</span> and the <span class="EmphasisFontCategoryNonProportional ">Categories=Beverages</span>. Anything in the external filter context that conflicts with these two filter settings will be overwritten. The fact that the external filter context sets <span class="EmphasisFontCategoryNonProportional ">Country=France</span> and <span class="EmphasisFontCategoryNonProportional ">Category=Condiment</span> is “overwritten” <em class="EmphasisTypeItalic ">for this measure</em>. Any other filters present in the filter context <em class="EmphasisTypeItalic ">are unaffected</em>.</p></td></tr></tbody></table></div></div><section class="Section2 RenderAsSection2" id="Sec5"><h3 class="Heading">Modifying the Filter Context</h3><div class="Para" id="Par53">In the preceding measure 3, we hard-coded two filter settings. In measure 2, we used the function REMOVEFILTERS. This is one of several functions you can use to modify the <span id="ITerm41">filter context</span>. I have listed some of these functions in the following. You are <em class="EmphasisTypeItalic ">not</em> expected to be a DAX expert to pass the PL-300 exam, but to continue your DAX learning, you should familiarize yourself with some of these functions:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par54">KEEPFILTERS</p></li><li><p class="Para" id="Par55">ALL</p></li><li><p class="Para" id="Par56">ALLEXCEPT</p></li><li><p class="Para" id="Par57">ALLSELECTED</p></li></ul></div></div><p class="Para" id="Par58">Every filter modifier argument for CALCULATE does one of two things: removes existing filters or adds a filter. Two different modifier arguments can be combined as well.</p></section>
<section class="Section2 RenderAsSection2" id="Sec6"><h3 class="Heading">Modifying the Model (Temporarily)</h3><div class="Para" id="Par59">There are times when the optimal model structure is different from what you need for a specific reporting requirement. Imagine an orders table that has multiple fields related to dates: order <span id="ITerm42">date</span>, ship date, delivery date. Let’s assume that the primary reporting requirement is on order date, so the active relationship should be between the date field in the date table and the order date field in the orders table. But on occasion, there is a requirement to report on ship date or delivery date, but the active relationship is still between order date and the date table. (Remember, you can only have one active relationship between two tables.) The answer is to create inactive relationships between tables. But how can you “activate” the inactive relationship? You can use USERELATIONSHIP with CALCULATE in a measure to activate the needed relationship. The following is an example of what the measure could look like:<div class="ProgramCode" id="PC6"><div class="LineGroup"><div class="FixedLine">SampleMeasure=CALCULATE</div><div class="FixedLine">(SUM('Orders'[Sales]),</div><div class="FixedLine">USERELATIONSHIP('Date'[Date], 'Orders'[ShipDate]))</div></div></div></div><p class="Para" id="Par60">Another example of a model-modifying function is CROSSFILTER, which changes the direction of a relationship.</p></section>
<section class="Section2 RenderAsSection2" id="Sec7"><h3 class="Heading">Row Context</h3><div class="Para" id="Par61">Now that we have introduced the filter context, let’s reintroduce the row context. You may recall that I mentioned the row context in the previous chapter, when explaining calculated columns. But the row context is broader than just a calculated column. Let’s use the same example we used in the last chapter: calculating sales (not including discount value). We can create two <span id="ITerm43">calculated columns</span> called <span class="EmphasisFontCategoryNonProportional ">[Subtotal]</span> and <span class="EmphasisFontCategoryNonProportional ">[LineTotal]</span> using these expressions:<div class="ProgramCode" id="PC7"><div class="LineGroup"><div class="FixedLine">Subtotal=</div><div class="FixedLine">'Orders Details'[Quantity]* 'Orders Details'[Unit Price]</div><div class="FixedLine">LineTotal =</div><div class="FixedLine">'Orders Details'[Subtotal]-'Orders Details'[DiscountValue]</div></div></div></div><div class="Para" id="Par62">But remember, we want to avoid creating calculated columns if we have an alternative. We can create a <span id="ITerm44">subtotal measure</span> using an iterator function—SUMX:<div class="ProgramCode" id="PC8"><div class="LineGroup"><div class="FixedLine">LineTotalAsMeasure =</div><div class="FixedLine">SUMX (</div><div class="FixedLine">'Orders Details',</div><div class="FixedLine">('Orders Details'[Quantity] * 'Orders Details'[UnitPrice]) - 'Orders Details'[Discountvalue]</div><div class="FixedLine">)</div></div></div></div><div class="Para" id="Par63"><span id="ITerm45">Iterator functions</span><span id="ITerm46"></span> have an X at the end of them: <span class="EmphasisFontCategoryNonProportional ">SUMX, AVERAGEX, MAXX, MINX, and COUNTAX</span> are examples. (Not every function has an iterator equivalent.) An iterator function evaluates an expression, row by row. In our model, we have three different methods to calculate the <span id="ITerm47">sales total</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par64">A calculated column called <span class="EmphasisFontCategoryNonProportional ">[LineTotal]</span> and using it in a visual</p></li><li><p class="Para" id="Par65">A measure called <span class="EmphasisFontCategoryNonProportional ">LineTotalAsMeasure</span></p></li><li><p class="Para" id="Par66">A measure called <span class="EmphasisFontCategoryNonProportional ">All_Sales</span></p></li></ul></div></div><div class="Para" id="Par67">In Figure <span class="InternalRef"><a href="#Fig13">7-13</a></span> you can see all three <span id="ITerm48">methods</span> used in the same visual.<figure class="Figure" id="Fig13"><div class="MediaObject" id="MO13"><img alt="" aria-describedby="d64e1386" src="../images/532800_1_En_7_Chapter/532800_1_En_7_Fig13_HTML.jpg" style="width:42.82em" width="1713" height="1374"/><div class="TextObject" id="d64e1386"><p class="Para" id="Par135">A screenshot of a2 page, which has a table with the company name, all sales, line total, and line total measure, and is indicated by the arrows.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-13</span><p class="SimplePara">Three different methods to calculate the same <span id="ITerm49">results</span></p></div></figcaption></figure></div><div class="Para" id="Par68">When should you create a calculated column and when should you use a measure with an iterator function? The answer is one we have already talked about: create a <span id="ITerm50">calculated column</span> when you need to use the resulting values in a slicer or filter, as shown in Figure <span class="InternalRef"><a href="#Fig14">7-14</a></span>. <em class="EmphasisTypeItalic ">You can’t use a measure in a slicer or a filter.</em><figure class="Figure" id="Fig14"><div class="MediaObject" id="MO14"><img alt="" aria-describedby="d64e1418" src="../images/532800_1_En_7_Chapter/532800_1_En_7_Fig14_HTML.png" style="width:42.85em" width="1714" height="1071"/><div class="TextObject" id="d64e1418"><p class="Para" id="Par136">A screenshot of a page, which has a table with the company name, all sales, line total, and line total measure, and the arrow indicates the line table in the filter pane.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-14</span><p class="SimplePara">Using a calculated column in a filter on the Filters <span id="ITerm51">pane</span></p></div></figcaption></figure></div></section>
</section>
<section class="Section1 RenderAsSection1" id="Sec8"><h2 class="Heading">Implicit and Explicit Measures</h2><div class="Para" id="Par69">In Figure <span class="InternalRef"><a href="#Fig14">7-14</a></span>, when we used the calculated column <span class="EmphasisFontCategoryNonProportional ">'Orders Details'[LineTotal]</span> in the visual, we created what is called an implicit measure. Implicit measures are convenient, but not the ideal way to perform a calculation because the default <span id="ITerm52">summarization</span> behavior can be readily changed as you can see in Figure <span class="InternalRef"><a href="#Fig15">7-15</a></span>. (There are other disadvantages to implicit measures as well.)<figure class="Figure" id="Fig15"><div class="MediaObject" id="MO15"><img alt="" aria-describedby="d64e1461" src="../images/532800_1_En_7_Chapter/532800_1_En_7_Fig15_HTML.jpg" style="width:25.1em" width="1004" height="1371"/><div class="TextObject" id="d64e1461"><p class="Para" id="Par137">A screenshot of a visualization window that lists the options under build visual, and the arrow indicates the highlighted count and the show value as options.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-15</span><p class="SimplePara">Changing the summarization of an implicit <span id="ITerm53">measure</span></p></div></figcaption></figure></div><div class="Para" id="Par70">Default summarization behavior is covered in Chapter <span class="ExternalRef"><a href="532800_1_En_6_Chapter.xhtml"><span class="RefSource">6</span></a></span>, where I also mentioned that removing the default summarization isn’t critical. Here’s why: instead of using an implicit measure, you should create explicit measures for any (and all, if possible) calculations that a report viewer will need. In Figure <span class="InternalRef"><a href="#Fig16">7-16</a></span>, the <span class="EmphasisFontCategoryNonProportional ">[All_Sales]</span> measure is used in the visual. This is an example of an explicit measure. Notice that the <span id="ITerm54">results</span><span id="ITerm55"></span> of the implicit and explicit measures are the same, as you can see in Figure <span class="InternalRef"><a href="#Fig16">7-16</a></span>.<figure class="Figure" id="Fig16"><div class="MediaObject" id="MO16"><img alt="" aria-describedby="d64e1521" src="../images/532800_1_En_7_Chapter/532800_1_En_7_Fig16_HTML.jpg" style="width:22.12em" width="885" height="1514"/><div class="TextObject" id="d64e1521"><p class="Para" id="Par138">A screenshot of a page, which has a table with the country, line total, and all sales, and the arrow indicates the implicit measure and the explicit measure.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-16</span><p class="SimplePara">The results of an implicit and explicit measure side by <span id="ITerm56">side</span><span id="ITerm57"></span></p></div></figcaption></figure></div><div class="Para" id="Par71">An explicit measure is “locked down”—the <span id="ITerm58">summarization</span> behavior cannot be modified as shown in Figure <span class="InternalRef"><a href="#Fig17">7-17</a></span>.<figure class="Figure" id="Fig17"><div class="MediaObject" id="MO17"><img alt="" aria-describedby="d64e1555" src="../images/532800_1_En_7_Chapter/532800_1_En_7_Fig17_HTML.jpg" style="width:33.98em" width="1359" height="878"/><div class="TextObject" id="d64e1555"><p class="Para" id="Par139">A screenshot of a page that lists the options under values, and the arrow indicates the explicit measure that changes the summarization behavior.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-17</span><p class="SimplePara">The summarization of an explicit measure cannot be <span id="ITerm59">modified</span></p></div></figcaption></figure></div><p class="Para" id="Par72">Once all the necessary explicit measures have been created, the “base” field can be hidden. As I stated in Chapter <span class="ExternalRef"><a href="532800_1_En_6_Chapter.xhtml"><span class="RefSource">6</span></a></span>, the <span id="ITerm60">hidden column</span> is not hidden from the report developer in the Power BI Desktop. Rather, hiding a base column (or any field) streamlines the model once the report is published.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar3"><div class="Heading">Tip</div><p class="Para FirstParaInFormalPara" id="Par73">It would not be unusual to hide all the fields in the fact table. Doing so ensures that <span id="ITerm61">report creators</span> would have to use the dimension table fields to create a visual, which is almost always preferable.</p></div></section>
<section class="Section1 RenderAsSection1" id="Sec9"><h2 class="Heading">Quick Measures</h2><div class="Para" id="Par74">Learning to write DAX is a nontrivial effort. There is a way to jump-start your learning: use the <span class="EmphasisFontCategoryNonProportional ">Quick measure</span> feature. In Figure <span class="InternalRef"><a href="#Fig18">7-18</a></span>, you can see the <span class="EmphasisFontCategoryNonProportional ">Quick measure</span> <span id="ITerm62">menu</span>.<figure class="Figure" id="Fig18"><div class="MediaObject" id="MO18"><img alt="" aria-describedby="d64e1628" src="../images/532800_1_En_7_Chapter/532800_1_En_7_Fig18_HTML.jpg" style="width:42.82em" width="1713" height="1391"/><div class="TextObject" id="d64e1628"><p class="Para" id="Par140">A screenshot of a page that lists the options under the format tab with the quick measure, which has a variety of calculation options and is indicated by the arrow.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-18</span><p class="SimplePara">There are built-in calculations in the Quick measure dialogue <span id="ITerm63">box</span></p></div></figcaption></figure></div><div class="Para" id="Par75">To create a quick <span id="ITerm64">measure</span>, drag fields from the list on the right-hand side to the appropriate field well on the left-hand side of the dialogue box. Let’s create a measure that calculates the average value for the orders of each product, as shown in Figure <span class="InternalRef"><a href="#Fig19">7-19</a></span>.<figure class="Figure" id="Fig19"><div class="MediaObject" id="MO19"><img alt="" aria-describedby="d64e1664" src="../images/532800_1_En_7_Chapter/532800_1_En_7_Fig19_HTML.jpg" style="width:42.82em" width="1679" height="1747"/><div class="TextObject" id="d64e1664"><p class="Para" id="Par141">A screenshot of a quick measure page with the calculation, base value, category, and fields, and the arrow indicates the list of fields and the product name.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-19</span><p class="SimplePara">Creating a quick <span id="ITerm65">measure</span></p></div></figcaption></figure></div><p class="Para" id="Par76">The <span class="EmphasisFontCategoryNonProportional ">Quick measure</span> wizard writes the DAX for you, which you can see once the measure is created.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar4"><div class="Heading">Tip</div><p class="Para FirstParaInFormalPara" id="Par77">Select the <span id="ITerm66">table</span> where you want the measure to appear, then right-click, and choose <span class="EmphasisFontCategoryNonProportional ">Quick measure</span>. This will ensure that the measure appears in the selected table. You can always re-home a measure (and a measure doesn’t care where it is), but it is nice to be able to find a measure quickly.</p></div><p class="Para" id="Par78">Once the <span class="EmphasisFontCategoryNonProportional ">Quick measure</span> wizard has created the measure, it will be named something awkward such as <span class="EmphasisFontCategoryNonProportional ">Price Minus Cost</span>. You will almost always want to rename these measures.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar5"><div class="Heading">Caution</div><p class="Para FirstParaInFormalPara" id="Par79">It does take a long time to learn how to write good DAX, and the <span class="EmphasisFontCategoryNonProportional ">Quick measure</span> wizard is a useful way to get started. However, DAX <span id="ITerm67">masters</span> say that the DAX created by the <span class="EmphasisFontCategoryNonProportional ">Quick measure</span> wizard can be “clunky.” This should not deter you from taking advantage of the wizard, but be aware that the DAX it generates can be improved.</p></div></section>
<section class="Section1 RenderAsSection1" id="Sec10"><h2 class="Heading">The Wonderful World of DAX Functions</h2><div class="Para" id="Par80">DAX provides several hundred <span id="ITerm68">functions</span> that can be divided into a few “families”:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par81">Logical</p></li><li><p class="Para" id="Par82">Aggregation</p></li><li><p class="Para" id="Par83">Statistical</p></li><li><p class="Para" id="Par84">Text</p></li><li><p class="Para" id="Par85">Time intelligence</p></li><li><p class="Para" id="Par86">Mathematical/trigonometric</p></li><li><p class="Para" id="Par87">Date/time</p></li><li><p class="Para" id="Par88">Filter</p></li><li><p class="Para" id="Par89">Table manipulation</p></li><li><p class="Para" id="Par90">Financial</p></li></ul></div></div><section class="Section2 RenderAsSection2" id="Sec11"><h3 class="Heading">Time Intelligence Functions</h3><div class="Para" id="Par91">Once you get the hang of the most common functions, for example, SUM, AVERAGE, COUNT, and CALCULATE, the next functions most people want to master are the time intelligence functions. <span id="ITerm69">Time intelligence functions</span> allow us to perform calculations that are commonly required in most reporting. Examples of these functions include<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par92">TOTALYTD</p></li><li><p class="Para" id="Par93">SAMEPERIODLASTYEAR</p></li><li><p class="Para" id="Par94"><span id="ITerm70">PARALLELPERIOD</span></p></li></ul></div></div><div class="Para" id="Par95">It’s unnecessary for me to list all the time intelligence functions as that information is easily found with a simple web search. Rather, I want to use this space to share some tips and tricks for using this group of functions:<div class="OrderedList"><ol><li class="ListItem"><div class="ItemNumber">1.</div><div class="ItemContent"><p class="Para" id="Par96">Time intelligence functions <em class="EmphasisTypeItalic ">require</em> a marked <span id="ITerm71">date table</span> to work (covered in Chapter <span class="ExternalRef"><a href="532800_1_En_5_Chapter.xhtml"><span class="RefSource">5</span></a></span>) because they operate on the premise that there is one row for every day between the earliest date and the latest date.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><div class="ItemNumber">2.</div><div class="ItemContent"><div class="Para" id="Par97">Time intelligence functions work best if you include a field from the date table on the visual. Otherwise, you will have a number that is opaque. Let’s look at some examples. First, here’s a simple time intelligence function that calculates sales <span id="ITerm72">year-to-date</span>. You can see the results of the measure in Figure <span class="InternalRef"><a href="#Fig20">7-20</a></span>:<div class="ProgramCode" id="PC9"><div class="LineGroup"><div class="FixedLine">YTD Sales =</div><div class="FixedLine">    TOTALYTD(</div><div class="FixedLine">    SUM('Orders Details'[LineTotal]),</div><div class="FixedLine">    'DateDim'[Date])</div></div></div></div></div><div class="ClearBoth"> </div></li></ol></div><figure class="Figure" id="Fig20"><div class="MediaObject" id="MO20"><img alt="" aria-describedby="d64e1847" src="../images/532800_1_En_7_Chapter/532800_1_En_7_Fig20_HTML.jpg" style="width:35.45em" width="1418" height="1217"/><div class="TextObject" id="d64e1847"><p class="Para" id="Par142">A screenshot of a page, which has a table with the year, all sales, and Y T D sales, and the arrow indicates the date dim and the total Y T D fields.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-20</span><p class="SimplePara">Using YTD in a <span id="ITerm73">visual</span></p></div></figcaption></figure></div><div class="Para" id="Par98">If we use the <span class="EmphasisFontCategoryNonProportional ">YTD Sales</span> measure in a visual <em class="EmphasisTypeItalic ">without</em> a date field, the result is opaque, as you can see in Figure <span class="InternalRef"><a href="#Fig21">7-21</a></span>.<figure class="Figure" id="Fig21"><div class="MediaObject" id="MO21"><img alt="" aria-describedby="d64e1876" src="../images/532800_1_En_7_Chapter/532800_1_En_7_Fig21_HTML.jpg" style="width:35.45em" width="1418" height="1181"/><div class="TextObject" id="d64e1876"><p class="Para" id="Par143">A screenshot of a page, which has a table with the year, all sales, and Y T D sales, and the arrow indicates the date dim that refers to the latest year in the data.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-21</span><p class="SimplePara">Using a time intelligence function without a date field can be <span id="ITerm74">ambiguous</span></p></div></figcaption></figure></div><div class="Para" id="Par99"><div class="OrderedList"><ol><li class="ListItem"><div class="ItemNumber">3.</div><div class="ItemContent"><div class="Para" id="Par100">Time intelligence functions can be used to modify the <span id="ITerm75">filter context</span>. For example, what if we want to calculate the sales for the same period last year?<div class="ProgramCode" id="PC10"><div class="LineGroup"><div class="FixedLine">Sales_Last_Year =</div><div class="FixedLine"> CALCULATE([All Sales],</div><div class="FixedLine">PARALLELPERIOD('DateDim'[Date],-12,MONTH)</div><div class="FixedLine">)</div></div></div></div></div><div class="ClearBoth"> </div></li></ol></div></div><div class="Para" id="Par101">There is a function called <span id="ITerm76">PARALLELPERIOD</span>, which allows you to set the clock back (or forward) to compare two time periods. In Figure <span class="InternalRef"><a href="#Fig22">7-22</a></span>, you can see the results of this measure.<figure class="Figure" id="Fig22"><div class="MediaObject" id="MO22"><img alt="" aria-describedby="d64e1931" src="../images/532800_1_En_7_Chapter/532800_1_En_7_Fig22_HTML.png" style="width:35.4em" width="1416" height="685"/><div class="TextObject" id="d64e1931"><p class="Para" id="Par144">A screenshot of a page, which has a table with the year, all sales, Y T D sales, and sales last year, and the arrow indicates the parallel period to modify the context.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-22</span><p class="SimplePara">Using ParallelPeriod to modify a filter <span id="ITerm77">context</span></p></div></figcaption></figure></div></section>
<section class="Section2 RenderAsSection2" id="Sec12"><h3 class="Heading">Semi-additive Measures</h3><p class="Para" id="Par102">Not everything that we want to calculate should result in a grand total. I call these types of calculations “point-in-time” <span id="ITerm78">calculations</span>. Officially, these types of calculations are called semi-additive. The classic example is a <span id="ITerm79">bank balance</span>. When you check your bank balance, it is a “snapshot” of your balance at that point in time. Another example is <span id="ITerm80">inventory balances</span>. If you are calculating inventory, you don’t want to see a total of the inventory over the month; you want to see the inventory at that point in time.</p><div class="Para" id="Par103">Once again, DAX to the rescue! There are multiple <span id="ITerm81">functions</span> that can be used to make these calculations. Examples include<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par104">OPENINGBALANCEYEAR</p></li><li><p class="Para" id="Par105">CLOSINGBALANCEYEAR</p></li><li><p class="Para" id="Par106">ENDOFMONTH</p></li><li><p class="Para" id="Par107">STARTOFMONTH</p></li></ul></div></div><p class="Para" id="Par108">Once again, I am not going to list all the semi-additive measures. A great place to research these functions is <span class="ExternalRef"><a href="http://www.sqlbi.com"><span class="RefSource"><span class="EmphasisFontCategoryNonProportional ">www.sqlbi.com</span></span></a></span>. They have posted in-depth articles on how these functions work.</p><div class="Para" id="Par109">Instead, I want to use the space to talk about semi-additive calculations that do not have dedicated functions. What if you want to total all the sales in each category, but each category is managed by a separate division and therefore adding them up is not meaningful? I call these <span id="ITerm82">non-totaling calculations</span>. You can see an example in Figure <span class="InternalRef"><a href="#Fig23">7-23</a></span>.<figure class="Figure" id="Fig23"><div class="MediaObject" id="MO23"><img alt="" aria-describedby="d64e2025" src="../images/532800_1_En_7_Chapter/532800_1_En_7_Fig23_HTML.jpg" style="width:35.05em" width="1402" height="1236"/><div class="TextObject" id="d64e2025"><p class="Para" id="Par145">A screenshot of a page, which has a table with the category name and all sales, along with their corresponding values.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-23</span><p class="SimplePara">A non-totaling <span id="ITerm83">measure</span></p></div></figcaption></figure></div><div class="Para" id="Par110">Your first thought might be to change the visual in some way. Tables and matrices have a formatting setting where you can <span id="ITerm84">turn off subtotals</span>, as shown in Figure <span class="InternalRef"><a href="#Fig24">7-24</a></span>.<figure class="Figure" id="Fig24"><div class="MediaObject" id="MO24"><img alt="" aria-describedby="d64e2059" src="../images/532800_1_En_7_Chapter/532800_1_En_7_Fig24_HTML.jpg" style="width:25.65em" width="1026" height="1652"/><div class="TextObject" id="d64e2059"><p class="Para" id="Par146">A screenshot of a visualization window that lists the options under visual, and the arrow indicates the turn-off option of the subtotals for every field used on the visual.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-24</span><p class="SimplePara">Turning off <span id="ITerm85">subtotals</span></p></div></figcaption></figure></div><div class="Para" id="Par111">But this is not a solution because any other field you add to the visual will also not be totaled. But there are <span id="ITerm86">functions</span> that allow you to turn off the total value without resorting to clumsy formatting:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par112">HASONEVALUE</p></li><li><p class="Para" id="Par113">HASONEFILTER</p></li><li><p class="Para" id="Par114">ISINSCOPE</p></li></ul></div></div><div class="Para" id="Par115">These are functions that test for a condition and, if the condition is true, perform the expression and, if it is false, leave a blank. Here’s an example:<div class="ProgramCode" id="PC11"><div class="LineGroup"><div class="FixedLine">Non-Total All_Sales =</div><div class="FixedLine">IF(</div><div class="FixedLine">HASONEVALUE('Categories'[CategoryName]),</div><div class="FixedLine">[All Sales]</div><div class="FixedLine">)<span id="ITerm87"></span></div></div></div></div><div class="Para" id="Par116">All these functions use the IF function to perform the logical test. In the preceding measure, the <span id="ITerm88">logical test</span> is whether, <em class="EmphasisTypeItalic ">in the current filter context</em>, the <span class="EmphasisFontCategoryNonProportional ">'Categories'[CategoryName]</span> field has one value. If the test returns true, then the <span class="EmphasisFontCategoryNonProportional ">[All Sales]</span> measure is calculated. If the test returns a false, then the measure returns a blank (because the false argument is not included) as <span id="ITerm89">shown</span> in Figure <span class="InternalRef"><a href="#Fig25">7-25</a></span>.<figure class="Figure" id="Fig25"><div class="MediaObject" id="MO25"><img alt="" aria-describedby="d64e2154" src="../images/532800_1_En_7_Chapter/532800_1_En_7_Fig25_HTML.png" style="width:42.8em" width="1712" height="980"/><div class="TextObject" id="d64e2154"><p class="Para" id="Par147">A screenshot of a page, which has a table with the category name, all sales, and non-total all sales, and the arrow indicates the beverages and the total values.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-25</span><p class="SimplePara">Using HASONEVALUE to turn off the totaling for one <span id="ITerm90">column</span></p></div></figcaption></figure></div><div class="Para" id="Par117">A variant of the HASONEVALUE is ISINSCOPE. At first glance, they seem to do the same thing and can, to some degree, be used interchangeably. However, there are differences. <span id="ITerm91">ISINSCOPE</span> checks to see if the visual is using the field to group the data. The easiest way to see this is in a matrix. To create this matrix, I first created a hierarchy in the data model, but the example works without a formal hierarchy as well. Then I created three measures using ISINSCOPE:<div class="Table" id="Tabb"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="tcol1 align-left"/><col class="tcol2 align-left"/></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">DAX Expression</p></th><th style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Explanation</p></th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">Address_All_Sales =</span></p><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">IF(</span></p><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">ISINSCOPE(</span></p><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">'Suppliers'[Address]),</span></p><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">[All Sales]</span></p><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">)</span><span id="ITerm92"></span></p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">This measure tests whether the <span class="EmphasisFontCategoryNonProportional ">'Suppliers'[Address]</span> field is being used to group the data.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">City_All_Sales =</span></p><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">IF(</span></p><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">ISINSCOPE(</span></p><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">'Suppliers'[City]),</span></p><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">[All Sales]</span></p><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">)</span></p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">This measure tests whether the <span class="EmphasisFontCategoryNonProportional ">'Suppliers'[City]</span> field is being used to group the data.</p></td></tr><tr><td style="border-right: 0.5pt solid ; text-align: left;"><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">Country_All_Sales =</span></p><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">IF(</span></p><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">ISINSCOPE(</span></p><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">'Suppliers'[Country]),</span></p><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">[All Sales]</span></p><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">)</span></p></td><td style="text-align: left;"><p class="SimplePara">This measure tests whether the <span class="EmphasisFontCategoryNonProportional ">'Suppliers'[Country]</span> field is being used to group the data.</p></td></tr></tbody></table></div></div><div class="Para" id="Par118">In Figure <span class="InternalRef"><a href="#Fig26">7-26</a></span>, you can see how these measures <span id="ITerm93">perform</span> in a matrix.<figure class="Figure" id="Fig26"><div class="MediaObject" id="MO26"><img alt="" aria-describedby="d64e2297" src="../images/532800_1_En_7_Chapter/532800_1_En_7_Fig26_HTML.png" style="width:42.85em" width="1714" height="1091"/><div class="TextObject" id="d64e2297"><p class="Para" id="Par148">A screenshot of a page, which has a table with the country, address of all sales, city of all sales, and country of all sales, and the arrow indicates Australia, Melbourne, and the address.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-26</span><p class="SimplePara">Anything lower in the hierarchy is in <span id="ITerm94">scope</span></p></div></figcaption></figure></div><p class="Para" id="Par119">In the <span class="EmphasisFontCategoryNonProportional ">Address_All_Sales</span> <span id="ITerm95">column</span>, the measure tests for the presence of the <span class="EmphasisFontCategoryNonProportional ">'Suppliers'[Address]</span> in the current filter context. Because the test returns TRUE, the <span class="EmphasisFontCategoryNonProportional ">All_Sales</span> measure is calculated. The next column, <span class="EmphasisFontCategoryNonProportional ">City_All_Sales</span>, tests for the presence of <span class="EmphasisFontCategoryNonProportional ">'Suppliers'[City]</span>. The test returns true for both the row with the city name and for the row with the address. Anything that is <em class="EmphasisTypeItalic ">lower</em> in the hierarchy is considered in scope.</p><p class="Para" id="Par120">In the preceding example, I used the formal hierarchy that I created. If I were to use the base fields, the result would be the same.</p></section>
<section class="Section2 RenderAsSection2" id="Sec13"><h3 class="Heading">Statistical Functions</h3><p class="Para" id="Par121">In the exam prep items for PL-300, there is a specific entry for the DAX <span id="ITerm96">statistical functions</span>. I am going to be candid here and state that I really don’t know why this subset of DAX functions was mentioned specifically. Statistical functions work the same way as other DAX functions. My guess is that while most of us can intuitively understand a logic or mathematical function, we may not be as familiar with basic statistics. I recommend that you familiarize yourself with some basic <span id="ITerm97">statistical principles</span>, such as median, average, and standard deviation.</p></section>
</section>
<section class="Section1 RenderAsSection1" id="Sec14"><h2 class="Heading">DAX Is Simple, but Not Easy</h2><p class="Para" id="Par122">This is a common saying in Power BI circles. I think it originated with either Alberto Ferrari or Marco Russo, the DAX <span id="ITerm98">powerhouses</span> who run <span class="ExternalRef"><a href="http://www.sqlbi.com"><span class="RefSource"><span class="EmphasisFontCategoryNonProportional ">www.SQLBI.com</span></span></a></span>. If you want to get better at DAX, focus on understanding filter and row <span id="ITerm99">contexts</span>. These are the two hardest concepts to master, but once you do, your DAX will improve dramatically.</p></section>
</div></div></div>
</div>
</body>
</html>